# Правила документирования

[← Назад к оглавлению](README.md)

---

## Формат docstring модуля

Каждый файл начинается с docstring:

```python
"""
ИмяМодуля — краткое описание назначения.

## Бизнес-контекст
Развёрнутое описание роли модуля в системе.
Какую бизнес-задачу решает.

## Входные данные
- param1: описание (тип)
- param2: описание (тип)

## Обработка
1. Первый шаг обработки
2. Второй шаг
3. И т.д.

## Выходные данные
- Что возвращает модуль/класс

## Зависимости
- Dependency1: для чего используется
- Dependency2: для чего используется
"""
```

## Формат docstring метода

```python
async def method_name(
    self,
    param1: Type1,
    param2: Type2,
) -> ReturnType:
    """
    Краткое описание метода.
    
    ## Входные данные
    - param1: описание параметра
    - param2: описание параметра
    
    ## Бизнес-логика
    Описание того, что происходит с точки зрения бизнеса.
    
    ## Обработка
    1. Шаг 1
    2. Шаг 2
    
    ## Выходные данные
    - Описание возвращаемого значения
    
    ## Исключения
    - ExceptionType: когда возникает
    """
```

## Обязательные секции

| Секция | Когда обязательна |
|--------|-------------------|
| **Бизнес-контекст** | Всегда для модулей |
| **Входные данные** | Если есть параметры |
| **Обработка** | Для сервисов и сложной логики |
| **Выходные данные** | Всегда |
| **Исключения** | Если метод бросает исключения |
| **Зависимости** | Для модулей с внешними зависимостями |

## Примеры

### Модель

```python
"""
CandidateModel — модель кандидата.

## Бизнес-контекст
Представляет кандидата, найденного через один из источников поиска.
Хранит профильные данные и связь с настройками поиска.

## Поля
- settings_id: привязка к поисковому запросу
- source_type: источник (LinkedIn, HH)
- full_name: ФИО кандидата
- profile_url: ссылка на профиль
- status: статус обработки (OK, DELETED, RESERVE)

## Связи
- settings: SearchSettingsModel (Many-to-One)
- evaluations: List[EvaluationModel] (One-to-Many)
"""
```

### Сервис

```python
"""
CandidateService — сервис управления кандидатами.

## Бизнес-контекст
Отвечает за жизненный цикл кандидата:
- Создание с дедупликацией
- Валидация релевантности через GPT
- Управление статусами
- Получение с фильтрацией

## Зависимости
- CandidateRepository: персистенция
- ValidatorService: валидация через GPT
- SearchSettingsRepository: проверка лимитов
"""
```

### Метод сервиса

```python
async def create_candidate(
    self,
    data: CandidateCreateSchema,
    session: AsyncSession,
    skip_validation: bool = False,
) -> Optional[CandidateModel]:
    """
    Создать нового кандидата.
    
    ## Входные данные
    - data: данные кандидата (CandidateCreateSchema)
    - session: сессия БД
    - skip_validation: пропустить GPT валидацию
    
    ## Обработка
    1. Проверка дубликата по profile_url
    2. Проверка лимитов настроек поиска
    3. Валидация релевантности через GPT (если не skip)
    4. Сохранение в БД
    
    ## Выходные данные
    - CandidateModel: успешно создан
    - None: дубликат, лимит достигнут, или не прошёл валидацию
    
    ## Исключения
    - ValueError: настройки поиска не найдены
    """
```

### Репозиторий

```python
async def get_by_profile_url(
    self,
    profile_url: str,
    session: AsyncSession,
) -> Optional[CandidateModel]:
    """
    Найти кандидата по URL профиля.
    
    ## Входные данные
    - profile_url: URL профиля (уникальный)
    - session: сессия БД
    
    ## Бизнес-логика
    Используется для дедупликации — проверки существования
    кандидата перед добавлением.
    
    ## Выходные данные
    - CandidateModel или None
    """
```

### API Endpoint

```python
@router.get(
    "",
    response_model=List[CandidateResponseSchema],
    summary="Получить список кандидатов",
    description="""
    ## Бизнес-логика
    Возвращает список кандидатов с фильтрацией по:
    - settings_id: ID настроек поиска
    - status: статус кандидата
    - source_type: источник (LinkedIn/HH)
    
    ## Пагинация
    - limit: максимум записей (1-100, по умолчанию 50)
    - offset: смещение (по умолчанию 0)
    """,
)
async def get_candidates(...):
    """
    Получить список кандидатов.
    
    ## Входные данные
    - settings_id: ID настроек (обязательно)
    - status, source_type: опциональные фильтры
    
    ## Выходные данные
    - List[CandidateResponseSchema]
    """
```

## Ключевые принципы

### 1. Бизнес-язык

Описывай **зачем**, а не только **как**:

```python
# ❌ Плохо — техническое описание
"""Проверяет существование записи в БД."""

# ✅ Хорошо — бизнес-контекст
"""
Используется для дедупликации — проверки существования
кандидата перед добавлением.
"""
```

### 2. Описывай граничные случаи

```python
## Выходные данные
- CandidateModel: успешно создан
- None: дубликат, лимит достигнут, или не прошёл валидацию
```

### 3. Документируй исключения

```python
## Исключения
- ValueError: настройки поиска не найдены
- RuntimeError: ошибка внешнего сервиса
```

---

[Далее: Слоистая архитектура →](05-dependencies.md)
